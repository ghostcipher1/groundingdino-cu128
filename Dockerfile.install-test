# Simple installation test for groundingdino-cu128 v0.2.1 from PyPI
# Tests installation on clean Ubuntu 22.04 environment

FROM ubuntu:22.04

# Prevent interactive prompts
ENV DEBIAN_FRONTEND=noninteractive

# Install Python and basic tools
RUN apt-get update && apt-get install -y \
    python3.10 \
    python3.10-dev \
    python3-pip \
    git \
    wget \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Upgrade pip
RUN python3.10 -m pip install --upgrade pip

# Install groundingdino-cu128 v0.2.1 from PyPI
RUN echo "Installing groundingdino-cu128 v0.2.1 from PyPI..." && \
    python3.10 -m pip install groundingdino-cu128==0.2.1

# Verify installation
RUN echo "\n========================================" && \
    echo "Verifying installation" && \
    echo "========================================\n" && \
    python3.10 -c "import groundingdino; print(f'✓ groundingdino imported')" && \
    python3.10 -c "import shadow_dino; print(f'✓ shadow_dino imported')" && \
    python3.10 -c "import groundingdino.version as v; print(f'Version: {v.__version__}')" && \
    python3.10 -c "from groundingdino import datasets; print('✓ datasets module works')" && \
    python3.10 -c "from groundingdino.datasets import transforms; print('✓ datasets.transforms works')"

# Test script
RUN echo '#!/bin/bash\n\
echo "==========================================" \n\
echo "groundingdino-cu128 v0.2.1 Installation Test" \n\
echo "==========================================" \n\
echo "" \n\
echo "Python: $(python3.10 --version)" \n\
echo "pip: $(python3.10 -m pip --version)" \n\
echo "" \n\
python3.10 -c "import groundingdino.version as v; print(f\"Package version: {v.__version__}\")" \n\
python3.10 -c "import shadow_dino; print(f\"shadow_dino version: {shadow_dino.__version__}\")" \n\
python3.10 -c "import shadow_dino; print(f\"CUDA available: {shadow_dino.__cuda_available__}\")" \n\
echo "" \n\
echo "Testing imports..." \n\
python3.10 -c "import groundingdino; import shadow_dino; from groundingdino import datasets; print(\"✓ All imports successful\")" \n\
echo "" \n\
echo "✓ Installation test passed!" \n\
' > /usr/local/bin/test.sh && chmod +x /usr/local/bin/test.sh

CMD ["/usr/local/bin/test.sh"]
